---
title: Multihack
author: attilathedud
date: 2023-12-25
category: FPS
layout: post
---

# Alvo

Nosso alvo √© o **Assault Cube 1.2.0.2**.

# Identificar

Vamos combinar todos os hacks das aulas anteriores (wallhack, triggerbot, aimbot, ESP) em um **multihack** com menu interativo para ligar/desligar cada hack individualmente.

<video controls autoplay loop>
  <source src="/assets/images/5/10/cube.mp4" />
</video>

# Entender

Para combinar todos os hacks, precisamos de uma t√©cnica chamada **refactoring** ‚Äî reorganizar o c√≥digo existente sem mudar o comportamento. O objetivo: encapsular funcionalidades em classes reutiliz√°veis e f√°ceis de ligar/desligar.

O c√≥digo completo est√° no [reposit√≥rio GitHub](https://github.com/GameHackingAcademy/AssaultCube_Multihack) da li√ß√£o. O branch `master` tem o c√≥digo final.

# Wallhack (Assault Cube)

A adapta√ß√£o do wallhack OpenGL √© mais simples que para o Urban Terror ‚Äî sem necessidade de filtrar por count ou ajustar clipping planes:

```c++
__declspec(naked) void opengl_codecave() {
    __asm { pushad }
    (*glDepthFunc)(0x207);    // GL_ALWAYS ‚Äî sempre desenha
    __asm {
        popad
        mov esi, dword ptr ds:[esi + 0xA18]
        jmp opengl_ret_address
    }
}
```

# Combinando os Hacks

Nosso multihack inclui:
- **OpenGL Wallhack**
- **Triggerbot**
- **Aimbot**
- **ESP**

O c√≥digo bruto combinado ultrapassa 300 linhas e fica dif√≠cil de manter. √â aqui que o **refactoring** com classes ajuda.

# Classe Triggerbot

Separamos o triggerbot numa classe pr√≥pria. O c√≥digo da cave apenas chama a classe:

```c++
triggerbot->execute(edi_value);
```

A classe Triggerbot (`Triggerbot.h` / `Triggerbot.cpp`):
```c++
class Triggerbot {
private:
    INPUT input = { 0 };
public:
    Triggerbot();
    void execute(int isLookingAtEnemy);
};
```

Agora toggle √© simples:
```c++
if(triggerbot_enabled) {
    triggerbot->execute(edi_value);
}
```

# Classe PlayerGeometry

Encapsula aimbot + ESP numa s√≥ classe. Exp√µe os arrays de X, Y e nomes:

```c++
class PlayerGeometry {
public:
    DWORD x_values[MAX_PLAYERS] = { 0 };
    DWORD y_values[MAX_PLAYERS] = { 0 };
    char* names[MAX_PLAYERS] = { NULL };
    int* current_players;

    PlayerGeometry(DWORD p_address, DWORD e_address, DWORD cp_address);
    void update();          // calcula posi√ß√µes ESP e yaw/pitch do aimbot
    void set_player_view(); // aplica yaw/pitch no jogador
};
```

Uso no main:
```c++
playerGeometry = new PlayerGeometry(0x509B74, 0x50F4F8, 0x50F500);
```

# Adicionando o Menu

```c++
class Menu {
public:
    const char* items[4] = { "Wallhack", "ESP", "Aimbot", "Triggerbot" };
    bool item_enabled[4] = { false };
    int cursor_position = 0;
    const char* cursor = ">";

    const char* get_state(int item);
    void handle_input();
};
```

**Navega√ß√£o com teclas:**
```c++
void Menu::handle_input() {
    if (GetAsyncKeyState(VK_DOWN) & 1)  cursor_position++;
    if (GetAsyncKeyState(VK_UP) & 1)    cursor_position--;

    // Alternar hab/desab com esquerda/direita
    if ((GetAsyncKeyState(VK_LEFT) & 1) || (GetAsyncKeyState(VK_RIGHT) & 1)) {
        item_enabled[cursor_position] = !item_enabled[cursor_position];
    }

    // Loop nos extremos do menu
    if (cursor_position < 0)  cursor_position = 3;
    if (cursor_position > 3)  cursor_position = 0;
}
```

**Exibindo o menu via print_text:**
```c++
for (int i = 0; i < 4; i++) {
    print_text(50, 250 + (100 * i), menu->items[i]);
    print_text(500, 250 + (100 * i), menu->get_state(i));
}
print_text(10, 250 + (100 * menu->cursor_position), menu->cursor);
```

# Toggleando Funcionalidades

Com o sistema de estados do menu, togglear √© simples:

```c++
#define WALLHACK   0
#define ESP        1
#define AIMBOT     2
#define TRIGGERBOT 3

// No OpenGL codecave:
if (menu->item_enabled[WALLHACK]) {
    (*glDepthFunc)(0x207);
}

// Na thread principal:
if (menu->item_enabled[AIMBOT]) {
    playerGeometry->set_player_view();
}
```

# Adicionando Cores ao Menu

O Assault Cube suporta texto colorido com prefix especial. Strings com `0x0C 0x30` ficam verdes; `0x0C 0x33` ficam vermelhas:

```c++
class Menu {
private:
    const char on_text[5]  = { 0xc, 0x30, 'O', 'N', 0 };       // verde
    const char off_text[6] = { 0xc, 0x33, 'O', 'F', 'F', 0 };  // vermelho
```

Com isso, o multihack est√° completo ‚Äî wallhack, aimbot, ESP, triggerbot, todos toggle√°veis pelo menu! üéÆ

O c√≥digo completo est√° no [GitHub](https://github.com/GameHackingAcademy/AssaultCube_Multihack).

&nbsp;

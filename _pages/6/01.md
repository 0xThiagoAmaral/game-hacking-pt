---
title: Fundamentos de Multiplayer
author: attilathedud
date: 2023-12-25
category: Multiplayer
layout: post
---

# Peer-2-Peer (P2P)

Imagine dois vizinhos querendo jogar xadrez. O vizinho A monta o tabuleiro em casa e dá a chave para o vizinho B. Para fazer um movimento, B precisa caminhar até a casa de A.

Esse é o modelo **peer-to-peer (P2P)**: um jogador é o **host** e os outros são **convidados**. Muitos jogos de console usam P2P. O problema: o host tem vantagem de latência, pois pode atualizar sua cópia local instantaneamente enquanto os outros precisam conectar até ele.

# Client-Server

Agora imagine que os dois vizinhos jogam xadrez enquanto um terceiro observa. Um quarto vizinho atua como **árbitro**: é o mais confiável, valida todos os movimentos e mantém o tabuleiro "oficial".

Para mover, cada jogador escreve sua jogada num envelope e coloca na caixa do árbitro. O árbitro valida, atualiza seu tabuleiro e notifica todos os outros. Se alguém tentar um movimento inválido, o árbitro rejeita.

Esse é o modelo **client-server** — que vimos brevemente na seção de [Fundamentos de Jogos](/pages/1/02/):

![Modelo Client/Server Básico](/assets/images/1/2/ClientServer.png)

O servidor é a entidade confiável. O cliente envia atualizações e o servidor as distribui para todos os outros jogadores. Se um cliente enviar muitos dados inválidos, o servidor o desconecta.

# Pacotes

No exemplo do xadrez, cada envelope com o movimento é um **pacote**. Em redes, pacotes contêm:
- Origem (quem enviou)
- Destino (para quem vai)
- Dados (o conteúdo)

Para minimizar o tempo de transmissão (e o lag), pacotes contêm o **mínimo de informação necessária**. Por exemplo, disparar um tiro pode ser apenas:

```c++
source: player
destination: server
data: f1    // 'f' = fire, '1' = 1 bala
```

# Protocolos de Rede

Para que dois computadores se entendam, precisam "falar a mesma língua" — isso se chama **protocolo**. Os dois principais protocolos de jogos são **UDP** e **TCP**.

> **UDP** — como um bilhete jogado na caixa do vizinho: você envia e não espera confirmação. Rápido, mas sem garantia de entrega. Os jogos usam UDP para dados que mudam rapidamente (posição do jogador).

> **TCP** — como cartas com aviso de recebimento: ambos os lados confirmam cada mensagem. Mais lento, mas confiável. Usado para chat, autenticação e dados críticos.

# Sockets

Pacotes TCP/UDP usam o **IP** para rotear chegada ao destino. Cada dispositivo tem um **endereço IP** (como um CEP) e os pacotes também têm um **número de porta** para diferenciar serviços.

Por exemplo:
- `123.45.67.89:80` → site HTTP
- `123.45.67.89:22` → SSH
- `127.0.0.1:15000` → servidor Wesnoth local

Um par IP:Porta é chamado de **socket**. No Windows, a API **WinSock** permite criar programas que comunicam por TCP ou UDP com qualquer destino.

&nbsp;
